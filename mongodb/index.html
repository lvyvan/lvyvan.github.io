<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>MongoDB - Yvan Blog</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "MongoDB";
    var mkdocs_page_input_path = "mongodb.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Yvan Blog</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">个人信息</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">前言</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../resume/">个人简历</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">技术分享</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../technology/">Technology</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">个人分享</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../book/">图书分享</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../calendar/">日历</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">个人笔记</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="#">Python</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../python1/">Python 基础</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../python2/">Python 面向对象</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../python_wsgi/">Python WSGI</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Sql and NoSql</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="./">MongoDB</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_1">mongodb的基本操作</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mongodb_2">mongodb 集合的基础命令</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_1">数据类型</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#object">object操作</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_2">数据的备份与恢复</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#aggregate">聚合aggregate</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_3">创建索引</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pymongo">pymongo</a>
    </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cshirp/">C#</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">关于</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Yvan Blog</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Sql and NoSql &raquo;</li>
        
      
        
          <li>个人笔记 &raquo;</li>
        
      
    
    <li>MongoDB</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="mongodb">mongodb</h1>
<h3 id="mongodb_1">mongodb的基本操作</h3>
<pre><code>1. 查看当前的数据库：db
2. 查看所有的数据库：show dbs / show databases
3. 切换数据库 use db_name
4. 删除当前的数据库 db.dropDatabase()
</code></pre>
<h3 id="mongodb_2">mongodb 集合的基础命令</h3>
<pre><code>1. 非手动创建集合，想不存在的集合中第一次加入数据时，集合会被自动创建出来。
2. 手动创建集合：
    &gt; db.createCollection(name, options)
    &gt; db.createCollection("stu")
    &gt; db.createCollection("sub", {capped: true, size: 10})
    &gt; 参数capped：默认值为false，表示不设置上线，值为true时表示设置上限。
    &gt; 参数size：当capped值为true时，需要指定此参数，表示上限大小，当文档达到上限时，会将之前的数据覆盖，单位为字节。
3. 参看集合：show collections
4. 删除集合：db.集合名称.drop()
</code></pre>
<h3 id="_1">数据类型</h3>
<pre><code>Object ID: 文档id  
String: 字符串，最常用，必须是有效的UTF-8  
Boolean: 存储一个布尔值，true或false  
Integer: 整数可以是32位或64位，这取决于服务器。  
Bouble: 存储浮点值  
Arrays: 数组或列表，多个值存储到一个键  
Object: 用于嵌入式的文档，即一个值为一个文档  
Null: 存储Null值  
Timestamp: 时间戳，表示从1970-1-1到现在的总秒数  
Date: 存储当前日期或时间的UNIX时间格式  
    &gt; 创建日期语句如下: 参数的格式为YYYY-MM-DD  
    &gt; new Date('2017-12-20')  
    &gt; 每个文档都有一个属性，为_id，保证每个文档的唯一性  
    &gt; 可以自己去设置_id插入文档，如果没有提供，那么MongoDB为每个文档提供一个独特的_id，类型为objectID  
    &gt; ObjectID是一个12字节的十六进制数  
        a. 4个字节为当前时间戳  
        b. 3个字节的机器ID  
        c. 2个字节为MongoDB的服务进程id
</code></pre>
<h3 id="object">object操作</h3>
<pre><code>1. 插入
    &gt; 插入 db.[集合名称].insert(document)
    &gt; db.stu.insert({[json]})
    &gt; db.stu.insert({_id:"obj_id", [json]})
    &gt; 插入文档时，如果不指定_id参数，MongoDB会为文档分配一个唯一的Objectd
2. 保存
    &gt; db.[集合名词].save(document)
    &gt; 如果文档的_id已经存在则修改，如果文档的_id不存在则添加
3. 更新
    &gt; db.[集合名词].update(&lt;query&gt;, &lt;update&gt;, {multi:&lt;boolean&gt;})
    &gt; 参数query: 查询条件
    &gt; 参数update：更新操作符
    &gt; 参数muluti: 可选，默认是false，表示只更新找到的第一条记录，值为True表示把满足条件的文档全部更新
    &gt; 注意： multi update only works with $ operators
4. 删除
    &gt; db.[集合名称].remove(&lt;query&gt;, {justOne:&lt;boolean&gt;})
    &gt; 参数query：可选，删除的文档条件
    &gt; 参数justOne: 可选，如果设置为true或1，则只删除一条，默认为false，表示删除多条。
    &gt; 注意：默认情况下，会将符合条件的文档全部删除，这与修改的默认策略截然不同
5. 查询
    &gt; 方法find(): 查询  db.[集合名词].find({条件json})
    &gt; 方法findOne(): 查询,只返回第一个  db.集合名词.findOne({条件json})
    &gt; 方法pretty(): 将结果格式化    db.[集合名词].find({条件文档}).pretty()
6. 比较运算符
    =     默认是等于判断，没有运算符
    &lt;     $lt (less than)
    &gt;=    $lte (less than equal)
    &gt;     $gt (greater than)
    &gt;=    $gte
    !=    $ne
7. 范围运算符
    (*)=  $in (多等于)
    (*)!= $nin (多不等于)
8. 逻辑运算符
    &gt; and:  在json中写多个条件即可.
    &gt; or:   使用$or,值为数组,数组中每个元素都为{json}
9. 正则表达式
    &gt; 使用 // 或 $regex 编写正则表达式
10. limit skip
    &gt; limit(): 用于读取指定数量的文档
    &gt; skip(): 用于跳过指定数量的文档
    &gt; 注意：二者可同时使用
11. 自定义查询
    &gt; 使用 $where 后面写一个函数,返回满足条件的数据。
12. 投影
    &gt; 在查询到的返回结果中，只选择必要的字段
    &gt; db.[集合名称].find({字段名称:1,...})
    &gt; 参数字段与值，值为表示显示,值为0不显示.
    &gt; 对于_id列默认是显示的，如果不显示需要明确设置为0
13.排序
    &gt; 方法sort(),用于对集进行排序
    &gt; db.集合名称.find().sort({字段:1,...})
    &gt; 参数1为升序排列,参数-1为降序排列
14.统计个数
    &gt; 方法count() 用于统计结果集中的文档条数
15.去重
    &gt; 方法 distinct("去重键", {json条件}) 对数据进行去重
</code></pre>
<h3 id="_2">数据的备份与恢复</h3>
<pre><code>1. 备份语法
    &gt; mongodump -h dbhost -d dbname -o dbdirectory
    &gt; -h 服务器地址,也可以指定端口号
    &gt; -d 需要备份的数据库名称
    &gt; -o 备份的数据存放位置,此目录中存放着备份出来的数据。
2. 恢复语法
    &gt; mongorestore -h dbhost -d dbname --dirdb directory
    &gt; -h 服务器地址
    &gt; -d 需要恢复的数据库实例
    &gt; --dir 备份数据所在位置
</code></pre>
<h3 id="aggregate">聚合aggregate</h3>
<pre><code>聚合(aggregate)是基于数据处理的聚合管道，每个文档通过一个由多个阶段(stage)组成的管道,可以对每个阶段的管道进行分组，过滤等功能，然后经过一系列的处理，输出相应的结果。
db.[集合名称.aggregate]({管道:{表达式}})
1. 表达式
    &gt; 处理输入文档并输出
    &gt; 语法：表达式:'$列名'
    &gt; $sum:     计算总和， $sum:1 表示以一倍计数
    &gt; $avg:     计算平均值
    &gt; $min:     获取最小值
    &gt; $max:     获取最大值
    &gt; $push:    在结果文档中插入值到一个数组中
    &gt; $first:   根据资源文档的排序获取第一个文档数据
    &gt; $last:    根据资源文档的排序获取最后一个文档数据
2. $group 将集合中的文档分组,可用于统计结果
    &gt; _id表示分组的依据,使用每个字段的格式为'$字段'
    &gt; $group 对应的字典中有几个键，结果中就有几个键
    &gt; 取不同的字段的值需要使用$, $gender, $age
    &gt; 取字典嵌套的字典中的值的时候 $_id.country
    &gt; 能够同时按照多个键进行分组{$group:{_id:{country:"$country", province:"$province"}}}
3. $project
    &gt; 修改输入文档的结构，如重命名，增加，删除字段，创建计算结果
4. $match
    &gt; 用于过滤数据,只输出符合条件的文档
5. $sort
    &gt; 将输入文档排序后输出
6. $limit
    &gt; 限制聚合管道返回的文档数
7. $skip
    &gt; 跳过指定数量的文档，并返回余下的文档
    &gt; 注意，先使用skip,后使用limit,以提高性能
8. $unwind
    &gt; 将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值
    &gt; unwind在字段等于 null, []的时候,属性 preserveNullAndEmptyArrays值为true，表示保留属性值为空的文档
    &gt; db.t.aggregate({$unwind:{path:'$字段名', preserveNullAndEmptyArrays:&lt;boolean&gt;}})
</code></pre>
<h3 id="_3">创建索引</h3>
<pre><code>索引: 以提升查询速度
语法: db.集合.ensureIndex({属性:1}), 1表示升序, -1表示降序
    &gt; 在大部分情况下,索引的升降序过度的影响查询速度
    &gt; 但在 sort 情况下, 同序性能会更优
    &gt; .explain('executionStats') 可获得查询时间等相关信息
    &gt; db.t.getindexes() 查看当前集合的所有索引
    &gt; db.t.dropIndex('索引名')
    &gt; 索引unique db.t.ensureIndex({"name":1}, {"unique": true})
    &gt; 联合索引 db.t.ensureIndex({name:1, age:1})
</code></pre>
<h3 id="pymongo">pymongo</h3>
<pre><code>from pymongo import MongoClint
</code></pre>
<pre><code class="python"># conding=utf-8

from pymongo import MongoClient

class TestMongo:
    def __init__(self):
        client = MongoClient(host=&quot;127.0.0.1&quot;, port=27017)
        collection = client[&quot;test&quot;][&quot;test1&quot;]

        # 插入多条数据, 返回插入的_id
        # ret1 = collection.insert({&quot;name&quot;:&quot;xiaohong&quot;, &quot;age&quot;: 10}) 
        # print(ret1)

        # 插入多条数据
        # data_list = [{&quot;name&quot;: &quot;test{}&quot;.format(i)} for i in range(15,20)]
        # rets = collection.insert_many(data_list)
        # print(rets)

        # 查询一个记录 :{'_id': ObjectId('5e81eba91968627157ad0349'), 'name': 'test15'}
        # t = collection.find_one({&quot;name&quot;: &quot;test15&quot;})
        # print(t)

        # 查询所有记录
        # cu = collection.find({&quot;name&quot;: &quot;test15&quot;})
        # print(cu)
        # for i in cu:
        #     print(i)
        # cu_lst = list(cu)
        #  &lt;pymongo.cursor.Cu rsor object at 0x0000023E264D9490&gt;
        # {'_id': ObjectId('5e81eba91968627157ad0349'), 'name': 'test15'}
        # Cursor 游标

        # 更新一条记录
        # ret = collection.update_one({&quot;name&quot;: &quot;test16&quot;}, {&quot;$set&quot;: {&quot;name&quot;: &quot;new_test16&quot;}})
        # print(ret)
        # &lt;pymongo.results.UpdateResult object at 0x0000024593F60900&gt;
        # 更新全部
        # collection.update_many({})

        # 删除
        # collection.delete_one()
        # collection.delete_many()

class main():
    TestMongo()

if __name__ == &quot;__main__&quot;:
    main()
</code></pre>

<pre><code class="ipython">In [1]: import datetime

In [2]: datetime.datetime.now()
Out[2]: datetime.datetime(2020, 3, 27, 11, 16, 51, 308012)

In [3]: type(datetime.datetime.now())
Out[3]: datetime.datetime
</code></pre>

<pre><code class="mongodb">&gt; show collections
&gt; new Date(&quot;2019-12-12&quot;)
# ISODate对应datetime.datetime类型
ISODate(&quot;2019-12-12T00:00:00Z&quot;)
&gt; db.test1.insert({&quot;name&quot;: &quot;xiaowang&quot;, &quot;age&quot;:10})
WriteResult({ &quot;nInserted&quot; : 1 })
&gt; db.test1.find()
{ &quot;_id&quot; : ObjectId(&quot;5e7d71a5b36e3c138608d6c3&quot;), &quot;name&quot; : &quot;xiaowang&quot;, &quot;age&quot; : 10 }
&gt; db.test1.insert({name:&quot;xiaohong&quot;, age:18})
WriteResult({ &quot;nInserted&quot; : 1 })
&gt; db.test1.find()
{ &quot;_id&quot; : ObjectId(&quot;5e7d71a5b36e3c138608d6c3&quot;), &quot;name&quot; : &quot;xiaowang&quot;, &quot;age&quot; : 10 }
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaohong&quot;, &quot;age&quot; : 18 }
&gt; db.test1.save({ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaohong&quot;, &quot;age&quot; : 16 })
WriteResult({ &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 })
&gt; db.test1.find()
{ &quot;_id&quot; : ObjectId(&quot;5e7d71a5b36e3c138608d6c3&quot;), &quot;name&quot; : &quot;xiaowang&quot;, &quot;age&quot; : 10 }
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaohong&quot;, &quot;age&quot; : 16 }

# 修改update
&gt; db.test1.update({&quot;name&quot; : &quot;xiaowang&quot;}, {&quot;name&quot; : &quot;xiaoming&quot;})
WriteResult({ &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 })
&gt; db.test1.find()
{ &quot;_id&quot; : ObjectId(&quot;5e7d71a5b36e3c138608d6c3&quot;), &quot;name&quot; : &quot;xiaoming&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaohong&quot;, &quot;age&quot; : 16 }
# 使用 $set:{json} 进行选定字符串修改
&gt; db.test1.update({&quot;name&quot; : &quot;xiaohong&quot;}, {$set:{&quot;name&quot;: &quot;xiaoqiang&quot;}})
WriteResult({ &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 })
{ &quot;_id&quot; : ObjectId(&quot;5e7d71a5b36e3c138608d6c3&quot;), &quot;name&quot; : &quot;xiaoming&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaoqiang&quot;, &quot;age&quot; : 16 }

# 删除
&gt; db.test1.remove({name:&quot;xiaoming&quot;},{justOne:true})
WriteResult({ &quot;nRemoved&quot; : 1 })
&gt; db.test1.find()
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaoqiang&quot;, &quot;age&quot; : 16 }

# 查询
&gt; db.test1.find({age:{$lte:18}})
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaoqiang&quot;, &quot;age&quot; : 16 }
&gt; db.test1.find({age:{$in:[16, 18]}})
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaoqiang&quot;, &quot;age&quot; : 16 }
# 使用 $where:function
&gt; db.test1.find({$where:function(){return this.age&lt;=18}})
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaoqiang&quot;, &quot;age&quot; : 16 }
# 只返回特定数据
&gt; db.test1.find({$where:function(){return this.age&lt;=18}},{name:1})
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaoqiang&quot;}

# 备份
PS C:\Users\Night\code\mongodb&gt; mongodump -d test1 -o .
2020-03-27T23:31:54.301+0800    writing test1.test1 to
2020-03-27T23:31:54.384+0800    done dumping test1.test1 (1 document)
PS C:\Users\Night\code\mongodb&gt; ls
    目录: C:\Users\Night\code\mongodb
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----         2020/3/27     23:31                test1

# 恢复
PS C:\Users\Night\code\mongodb&gt; mongorestore -d test2 --dir test1
2020-03-27T23:39:34.469+0800    the --db and --collection args should only be used when restoring from a BSON file. Other uses are deprecated and will not exist in the future; use --nsInclude instead
2020-03-27T23:39:34.501+0800    building a list of collections to restore from test1 dir
2020-03-27T23:39:34.504+0800    reading metadata for test2.test1 from test1\test1.metadata.json
2020-03-27T23:39:34.539+0800    restoring test2.test1 from test1\test1.bson
2020-03-27T23:39:34.544+0800    no indexes to restore
2020-03-27T23:39:34.544+0800    finished restoring test2.test1 (1 document, 0 failures)
2020-03-27T23:39:34.544+0800    1 document(s) restored successfully. 0 document(s) failed to restore.

# 聚合 aggregate
&gt; db.test1.aggregate(
    {$group:{_id:&quot;$age&quot;, count:{$sum:1}}}
    )
{ &quot;_id&quot; : 16 }
&gt;  db.test1.aggregate(
...     {$group:{_id:&quot;$age&quot;, count:{$sum:1}}}
...     )
{ &quot;_id&quot; : 16, &quot;count&quot; : 1 }
&gt; db.test1.aggregate(
...     {$group:{_id:&quot;$age&quot;,
...     count:{$sum:1},
...     avg_age:{$avg:&quot;$age&quot;}
...     }}
...     )
{ &quot;_id&quot; : 16, &quot;count&quot; : 1, &quot;avg_age&quot; : 16 }
&gt; db.test1.aggregate(
...     {
...         $group:{
...             _id:&quot;$age&quot;,
...             count:{$sum:1},
...             avg_age:{$avg:&quot;$age&quot;}
...         }
...     },
...     {
...         $project:{
...             gender:&quot;$_id&quot;,
...             count:&quot;$count&quot;,
...             avg_age:&quot;$avg_age&quot;
...         }
...     }
... )

{ &quot;_id&quot; : 16, &quot;gender&quot; : 16, &quot;count&quot; : 1, &quot;avg_age&quot; : 16 }
&gt; db.test1.insert({&quot;username&quot;: &quot;Alex&quot;, &quot;tags&quot;:['C#', 'Java', 'C++']})
WriteResult({ &quot;nInserted&quot; : 1 })
&gt; db.test1.find()
{ &quot;_id&quot; : ObjectId(&quot;5e7d72cfb36e3c138608d6c4&quot;), &quot;name&quot; : &quot;xiaoqiang&quot;, &quot;age&quot; : 16 }
{ &quot;_id&quot; : ObjectId(&quot;5e8001f313c2dc467a07b8d8&quot;), &quot;username&quot; : &quot;Alex&quot;, &quot;tags&quot; : [ &quot;C#&quot;, &quot;Java&quot;, &quot;C++&quot; ] }
&gt; db.test1.aggregate({$match:{username:&quot;Alex&quot;}})
{ &quot;_id&quot; : ObjectId(&quot;5e8001f313c2dc467a07b8d8&quot;), &quot;username&quot; : &quot;Alex&quot;, &quot;tags&quot; : [ &quot;C#&quot;, &quot;Java&quot;, &quot;C++&quot; ] }
&gt; db.test1.aggregate({$match:{username:&quot;Alex&quot;}},{$unwind:&quot;$tags&quot;})
{ &quot;_id&quot; : ObjectId(&quot;5e8001f313c2dc467a07b8d8&quot;), &quot;username&quot; : &quot;Alex&quot;, &quot;tags&quot; : &quot;C#&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5e8001f313c2dc467a07b8d8&quot;), &quot;username&quot; : &quot;Alex&quot;, &quot;tags&quot; : &quot;Java&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5e8001f313c2dc467a07b8d8&quot;), &quot;username&quot; : &quot;Alex&quot;, &quot;tags&quot; : &quot;C++&quot; }
&gt; db.test1.aggregate({$match:{username:&quot;Alex&quot;}},{$unwind:&quot;$tags&quot;},{$group:{_id:null, sum:{$sum:1}}})
{ &quot;_id&quot; : null, &quot;sum&quot; : 3 }

# 索引
&gt; use test2
switched to db test2
&gt; for(i=0; i&lt;100000; i++){db.test2.insert({name:'test'+i, age:i})}
WriteResult({ &quot;nInserted&quot; : 1 })
&gt; db.test2.find().count()
100000
&gt; db.test2.find()
{ &quot;_id&quot; : ObjectId(&quot;5e80087a13c2dc467a07b8d9&quot;), &quot;name&quot; : &quot;test0&quot;, &quot;age&quot; : 0 }
Type &quot;it&quot; for more
&gt; db.test2.find({name:&quot;test99999&quot;})
{ &quot;_id&quot; : ObjectId(&quot;5e8008b813c2dc467a093f78&quot;), &quot;name&quot; : &quot;test99999&quot;, &quot;age&quot; : 99999 }
&gt; db.test2.find({name:&quot;test99999&quot;}).explain('executionStats')
{
    ...
}
# 创建索引
&gt; db.test2.ensureIndex({name:1})
{
        &quot;createdCollectionAutomatically&quot; : false,
        &quot;numIndexesBefore&quot; : 1,
        &quot;numIndexesAfter&quot; : 2,
        &quot;ok&quot; : 1
}
# 查看当前库的所有索引
&gt; db.test2.getIndexes()
[
        {
                &quot;v&quot; : 2,
                &quot;key&quot; : {
                        &quot;_id&quot; : 1
                },
                &quot;name&quot; : &quot;_id_&quot;,
                &quot;ns&quot; : &quot;test2.test2&quot;
        },
        {
                &quot;v&quot; : 2,
                &quot;key&quot; : {
                        &quot;name&quot; : 1
                },
                &quot;name&quot; : &quot;name_1&quot;,
                &quot;ns&quot; : &quot;test2.test2&quot;
        }
]

# 删除索引
&gt; db.test2.dropIndex({name:1})
{ &quot;nIndexesWas&quot; : 2, &quot;ok&quot; : 1 }
&gt; db.test2.getIndexes()
[
        {
                &quot;v&quot; : 2,
                &quot;key&quot; : {
                        &quot;_id&quot; : 1
                },
                &quot;name&quot; : &quot;_id_&quot;,
                &quot;ns&quot; : &quot;test2.test2&quot;
        }
]

db.test1.aggregate(
    {
        $match:{
            $or:[
                {age:{$gt:15}},
                {name:{
                        $in:[&quot;xiaoming&quot;,&quot;xiaoqiang&quot;,&quot;xiaohong&quot;]
                    }
                }
            ]
        }
    },
    {
        $group:{
            _id:&quot;$age&quot;,
            count:{$sum:1},
            avg_age:{$avg:&quot;$age&quot;}
        }
    },
    {
        $project:{
            gender:&quot;$_id&quot;,
            count:&quot;$count&quot;,
            avg_age:&quot;$avg_age&quot;
        }
    }
)
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cshirp/" class="btn btn-neutral float-right" title="C#">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../python_wsgi/" class="btn btn-neutral" title="Python WSGI"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../python_wsgi/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../cshirp/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
