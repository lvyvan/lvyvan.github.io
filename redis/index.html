<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Redis - Yvan Blog</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Redis";
    var mkdocs_page_input_path = "redis.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Yvan Blog</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">个人信息</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">前言</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../resume/">个人简历</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">技术分享</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../technology/">Technology</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">个人分享</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../book/">图书分享</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../calendar/">日历</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">个人学习笔记</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Python</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../python/">Python</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../python_wsgi/">Python WSGI</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Sql and NoSql</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../mongodb/">MongoDB</a>
                </li>
                <li class="toctree-l2"><a class="" href="../mysql.dm">Mysql</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Git</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../git/">Git</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">C#</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../cshirp/">C#</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">JavaScrip</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../javascrip/">JavaScrip</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Java</a>
    <ul>
                <li class="toctree-l2"><a class="" href="Java:'java.md'">None</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">个人阅读笔记</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../marxism_leninism/">марксизм-ленинизм</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../temp/">Temp</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">关于</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Yvan Blog</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Redis</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="redis">Redis</h1>
<h2 id="redis_1">Redis数据结构</h2>
<h3 id="1-string">1. String</h3>
<ul>
<li><code>SET key value</code> 存入字符串键值对</li>
<li><code>MSET key value [key value]</code> 批量存储字符串键值对</li>
<li><code>SETNX key value</code> 存入一个不存在的字符串键值对</li>
<li><code>GET key</code>  获取一个字符串值</li>
<li><code>MGET key</code> 批量获取字符串键值</li>
<li><code>DEL key [value]</code> 删除一个键</li>
<li><code>EXPLRE key seconds</code> 设置一个键的过期时间(秒)</li>
<li><code>INCR key</code> 将key中存储的数字值+1</li>
<li><code>DECR key</code> 将key中存储的数字值-1</li>
<li><code>INCRBY key increment</code>  将key中存储的值+increment</li>
<li><code>DECRBY key decrement</code>  将key所存储的值-decrement</li>
</ul>
<h3 id="2-hash">2. Hash</h3>
<ul>
<li><code>HSET key field value</code> 存储一个哈希表key的键值</li>
<li><code>HSETNX key field value</code> 存储一个不存在的哈希表key的键值</li>
<li><code>HMSET key field value [file value]</code> 在一个哈希表中存储多个键值对</li>
<li><code>HGET key field</code> 获取哈希表key对应的field键值</li>
<li><code>HMGET key field [field ...]</code> 批量获取哈希表key中多个field键值</li>
<li><code>HDEL key field [field ...]</code> 删除哈希表key中的field键值</li>
<li><code>HLEN key</code> 返回哈希表key中field的数量</li>
<li><code>HGETALL key</code> 返回哈希表key中所有的键值</li>
<li><code>HINCRBY key field increment</code> 为哈希表key中field键加上增量increment</li>
</ul>
<h3 id="3-list">3. List</h3>
<ul>
<li><code>LPUSH key value [value ...]</code> 将一个或多个值value插入到key列表的表头</li>
<li><code>RPUSH key value [value ...]</code> 将一个或多个值value插入到key列表的表尾</li>
<li><code>LPOP key</code> 移除并返回key列表的头元素</li>
<li><code>RPOP key</code> 移除并返回key列表的尾元素</li>
<li><code>LRANGE key start stop</code> 返回列表key中指定区间的元素，区间以偏移量start和stop指定</li>
<li><code>BLPOP key [key ...] timeout</code> 从key列表表头弹出一个元素，若列表中没有元素，阻塞等待timeout秒，如果timeout=0，一直阻塞等待。</li>
<li><code>BRPOP key [key ...] timeout</code> 从key列表表尾弹出一个元素，若列表中没有元素，阻塞等待timeout秒，如果timeout=0，一直阻塞等待。</li>
</ul>
<h3 id="4-set">4. Set</h3>
<ul>
<li><code>SADD key member [member ...]</code> 往合集key中存入元素，元素存在则忽略</li>
<li><code>SREM key member [member ...]</code> 从集合key中删除元素</li>
<li><code>SMEMBERS key</code> 获取集合key中所有元素</li>
<li><code>SCARD key</code> 获取集合key的元素个数</li>
<li><code>SISMEMBER</code> 判断Member元素是否存在与集合key中</li>
<li><code>SRANDMEMEBER key [count]</code> 从集合key中选出count个元素，元素不从key中删除</li>
<li><code>SPOP key [count]</code> 从集合key中选出count个元素，元素从key中删除</li>
<li>操作</li>
<li><code>SINTER key [key ...]</code> 交集运算</li>
<li><code>SINTERSTORE destination key [key ...]</code> 将交集结果存入新集合destination中</li>
<li><code>SUNION key [key ...]</code> 并集运算</li>
<li><code>SUNIONSTORE destination key [key ...]</code> 将并集结果存入新集合destination中</li>
<li><code>SDIFF key [key ...]</code> 差集运算</li>
<li><code>SDIFFSTORE destination key [key ...]</code> 将差集结果 存入新集合destination中</li>
</ul>
<h3 id="5-zset">5. Zset</h3>
<ul>
<li><code>ZADD key score member [[score member] ...]</code> 往有序集合key中加入带分值元素</li>
<li><code>ZREM key member [member ...]</code> 从有序集合key中删除元素</li>
<li><code>ZSCORE key member</code> 返回有序集合key中元素member的分值 </li>
<li><code>ZINCRBY key increment member</code> 为有序集合key中元素member的分值加上increment</li>
<li><code>ZCARD key</code> 返回有序集合key中元素个数</li>
<li><code>ZRANGE key start stop [WITHSCORES]</code> 正序获取有序集合key从start下标到stop下标的元素</li>
<li><code>ZREVRANGE key start stop [WITHSCORES]</code> 倒序获取有序集合key从start下标到stop下标的元素</li>
<li>操作</li>
<li><code>ZUNIONSTORE destkey numkeys key [key ...]</code> 并集计算</li>
<li><code>ZINTERSTORE destkey numkeys key [key ...]</code> 交集计算</li>
</ul>
<h2 id="redis_2">Redis应用场景</h2>
<h3 id="string">String</h3>
<ul>
<li>单值缓存 <code>SET key value</code> | <code>GET key</code></li>
<li>对象缓存 <code>SET key:value(json)</code> | <code>MSET key vlaue [key vlaue]</code></li>
<li>分布式锁 
    &gt; <code>SETNX key:num true</code> 返回1代表获取锁成功<br />
    &gt; <code>SETINX key:num true</code> 返回0代表获取锁失败<br />
    &gt; ... 业务操作<br />
    &gt; <code>DEL key:num</code> 执行完成业务释放锁<br />
    &gt; <code>SET key:num true ex 10 nx</code> 防止程序意外终止导致死锁</li>
<li>计数器 <code>INCR key num</code> | <code>GET key num</code>  </li>
<li>Web集群Session共享 <code>Spring Session + redis 实现Session</code></li>
<li>分布式系统全局序列号 <code>INCRBY orderld 1000</code> redis批量生产序列号提升性能</li>
</ul>
<h3 id="hash">Hash</h3>
<ul>
<li>优点
    &gt; 同类数据归类整合存储，方便数据管理
    &gt; 相比<code>String</code>操作消耗内存与cpu更小
    &gt; 相比<code>String</code>存储更节省空间</li>
<li>缺点
    &gt; 过期功能不饿能使用在<code>field</code>上，只能使用在<code>key</code>上
    &gt; <code>Redis</code>集群架构下不适合大规模使用</li>
<li>对象缓存 
    &gt; <code>HMSET key field value [field value]</code>
    &gt; <code>HMSET user id:field value [... ]</code></li>
<li>电商购物车
    &gt; 以用户ID为key, 商品id为field, 商品数量为value  </li>
</ul>
<h3 id="3-list_1">3. List</h3>
<ul>
<li>常用数据结构
    &gt; <code>Stack = LPUSH + LPOP -&gt; FILQ</code>
    &gt; <code>Queue = LPUSH +RPOP</code>
    &gt; <code>Blocking MQ(阻塞队列) = LPUSH + BRPOP</code></li>
</ul>
<h3 id="4-set_1">4. Set</h3>
<ul>
<li>微信抽奖小程序
    &gt; 点击参与抽奖加入集合 <code>SADD key {userId}</code>
    &gt; 查看参与抽奖所有用户 <code>SMEMBERS key</code>
    &gt; 抽取count名中奖者 <code>SRANDMEMVER key [count] / SPOP key [count]</code></li>
<li>微信微博点赞，收藏，标签
    &gt; 点赞 <code>SADD like:{消息ID} {用户ID}</code>
    &gt; 取消点赞 <code>SREM like:{消息ID} {用户ID}</code>
    &gt; 检查用户是否点过赞 <code>SISMEMBER like:{消息ID} {用户ID}</code>
    &gt; 获取点赞的用户列表 <code>SMEMBERS like:{消息ID}</code>
    &gt; 获取点赞用户数 <code>SCARD like:{消息ID}</code></li>
<li>集合操作实现关注模型
    &gt; <code>依恋</code>关注的人 <code>ylfollow -&gt; {aa, bb ,cc}</code>
    &gt; <code>月明</code>关注的人 <code>ymfollow -&gt; {aa, dd, gg}</code>
    &gt; <code>亦菲</code>关注的人 <code>yffollow -&gt; {bb, dd, ff}</code>
    &gt; <code>月明</code>和<code>亦菲</code>共同关注的人 <code>SINTER ymfollow yffollow -&gt; {dd}</code>
    &gt; <code>月明</code> 我<code>依恋</code>关注的人也关注了她 <code>SISMEMBER aa ymfollow</code>
    &gt; <code>依恋</code>与<code>月明</code> 可能认识的人 <code>SDIFF ylfollow ymfollow</code> </li>
</ul>
<h3 id="5-zset_1">5. Zset</h3>
<ul>
<li>排行榜</li>
<li>布隆过滤器</li>
</ul>
<h2 id="redis_3">Redis 实现分布式锁</h2>
<h3 id="redisson">Redisson</h3>
<h2 id="redis_4">Redis 分布式集群</h2>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
